-- Criar o diretório C:\BDMusic--
CREATE DATABASE BD Music

ON  PRIMARY (
NAME = 'BD Music',
FILENAME = 'C:\FBD\BDMusic.mdf',
SIZE = 5120KB,
FILEGROWTH = 1024KB
),

FILEGROUP BDM_fg01
(
NAME = 'bdm_001',
FILENAME = 'C:\FBD\bdm_001.ndf',
SIZE = 5120KB,
FILEGROWTH = 30%
), 

FILEGROUP BDM_fg02
(
NAME = 'bdm_002-1',
FILENAME = 'C:\FBD\bdm_002_1.ndf',
SIZE = 2048KB,
MAXSIZE = 5120KB,
FILEGROWTH = 1024KB
),
(
NAME ='bdm_002-2',
FILENAME = 'C:\FBD\bdm_002_2.ndf',
SIZE = 1024KB,
MAXSIZE = 3072KB,
FILEGROWTH = 15%
),

LOG ON 
(
NAME = 'bdm_log',
FILENAME = 'C:\FBD\bdm_log.ldf',
SIZE = 1024KB,
FILEGROWTH = 10%
)

--Criar tabelas
CREATE TABLE composicoes(
  cod_composicoes int NOT NULL,
    descricao varchar(140),
    tipo_composicao varchar(20),
    CONSTRAINT PK_COMPOSICOES PRIMARY KEY (cod_composicoes)
) on BDM_fg_02

CREATE TABLE albuns(
    cod_album int not null,
    descricao varchar(140),
    preco_compra double,
    data_compra date,
    data_gravacao date,
    tipo_compra varchar(8),
    cod_gravadora int not null,
    CONSTRAINT PK_ALBUNS PRIMARY KEY (cod_album),
    CONSTRAINT FK_ALBUNS_GRAVADORAS FOREIGN KEY (FK_cod_gravadora) REFERENCES gravadoras
) on BDM_fg02

CREATE TABLE faixas(
  cod_faixas int NOT NULL,
  descricao varchar(140),
  duracao decimal(5,2),
  tipo_gravacao varchar(20),
    cod_composicoes varchar(20),
    CONSTRAINT PK_FAIXAS PRIMARY KEY (cod_faixas),
    CONSTRAINT FK_FAIXAS_COMPOSICOES FOREIGN KEY (FK_cod_composicoes) REFERENCES composicoes
) on BDM_fg01

CREATE TABLE playlists(
  cod_pĺaylist int NOT NULL,
    nome varchar(20),
    duração double,
    criação date,
    CONSTRAINT PK_PLAYLISTS PRIMARY KEY (cod_playlist)
) on BDM_fg01

CREATE TABLE AUX_PLAYLISTS_FAIXAS(
  cod_playlist int NOT NULL,
    cod_faixas int,
    num_de_vezes int,
    ultima_vez date,
    CONSTRAINT PK_TABELA06 PRIMARY KEY (cod_playlis,cod_faixas),
    CONSTRAINT FK_TABELA06_PLAYLISTS FOREIGN KEY (cod_playlist) REFERENCES playlist,
    CONSTRAINT FK_TABELA06_FAIXAS FOREIGN KEY (cod_faixas) REFERENCES faixas
) on BDM_fg01

CREATE TABLE AUX_FAIXAS_COMPOSITORES(
  cod_faixas int NOT NULL,
    cod_compositores int NOT NULL,
    CONSTRAINT PK_TABELA03 PRIMARY KEY (cod_faixas, cod_compositor),
    CONSTRAINT FK_TABELA03_FAIXAS FOREIGN KEY (cod_faixas) REFERENCES faixas,
    CONSTRAINT FK_TABELA03_COMPOSITORES FOREIGN KEY (cod_compositor) REFERENCES compositores
) on BDM_fg02

CREATE TABLE compositores(
  cod_compositores int NOT NULL,
    nome varchar(20),
    data_nasc date,
    data_morte date,
    pais varchar(20),
    cidade varchar(29),
    estado varchar(20),
    CONSTRAINT PK_COMPOSITORES PRIMARY KEY(cod_compositores)
) on BDM_fg02

CREATE TABLE tabela_04(
  cod_compositores int NOT NULL,
    cod_periodos int NOT NULL,
    CONSTRAINT PK_TABELA04_COMPOSITORES FOREIGN KEY (cod_compositores) REFERENCES compositores
    CONSTRAINT PK_TABELA03_PERIODOS FOREIGN KEY ()
) on BDM_fg02

CREATE TABLE periodos(
  cod_periodos int NOT NULL,
    intervalo int,
    descrição varchar(140),
    CONSTRAINT FK_PERIODOS PRIMARY KEY (cod_periodos)
) on BDM_fg02

CREATE TABLE tabela_02(
  cod_faixas int NOT NULL,
    cod_interpretes int NOT NULL,
  CONSTRAINT PK_TABELA02 PRIMARY KEY (cod_faixas,cod_interpretes),
    CONSTRAINT FK_TABELA02_FAIXAS FOREIGN KEY (cod_faixas) REFERENCES faixas,
    CONSTRAINT FK_TABELA02_INTERPRETES FOREIGN KEY (cod_interpretes) REFERENCES interpretes
) on BDM_fg02

CREATE TABLE interpretes(
  cod_interpretes int NOT NULL,
    nome varchar(29),
    tipo_interprete varchar(20),
    CONSTRAINT PK_INTERPRETES PRIMARY KEY (cod_interpretes)
) on BDM_fg02


CREATE TABLE gravadoras(
  cod_gravadoras int NOT NULL,
    nome varchar(29),
    endereço varchar(29),
    homepage varchar(39),
    CONSTRAINT PK_GRAVADORAS PRIMARY KEY (cod_gravadoras)
) on BDM_fg02

CREATE TABLE telefones(
  cod_gravadoras int NOT NULL,
    telefones int,
    CONSTRAINT PK_TELEFONES PRIMARY KEY (cod_gravadoras,telefones),
    FOREIGN KEY FK_TELEFONES_GRAVADORAS FOREIGN KEY (cod_gravadoras) REFERENCES gravadoras
) on BDM_fg02

CREATE TABLE AUX_FAIXAS_ALBUNS(
  cod_albums int not null,
    cod_faixas int not null
    CONSTRAINT PK_
    
) on BDM_fg02


CREATE CLUSTERED INDEX indicfaixaprimario ON faixas WITH PAD_INDEX OFF FILLFACTOR 100 ON BDM_fg02

CREATE NONCLUSTERED INDEX indicfaixasecundario ON faixas WITH PAD_INDEX OFF FILLFACTOR 100 ON BDM_fg02

CREATE VIEW V1(Playlist, )
AS
  SELECT p.nome, count(*)
    FROM playlists p, AUX_PLAYLISTS_FAIXAS aux_p_f
    WHERE p.cod_playlist = aux_p_f.cod_playlist
    group by p.nome, p.cod_playlist









